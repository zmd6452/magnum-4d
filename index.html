<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Malaysia 4D Results Tracker</title>

<meta name="description" content="Malaysia 4D results tracker for Magnum, Toto and Da Ma Cai. Frequency, hot numbers, predictions and CSV export.">
<meta name="robots" content="index, follow">
<meta name="theme-color" content="#0d6efd">

<link rel="manifest" href="manifest.json">

<style>
body{font-family:Arial,sans-serif;max-width:1200px;margin:auto;padding:10px}
button{padding:10px 15px;margin:5px;border:none;border-radius:6px;background:#0d6efd;color:#fff}
button.active{background:#198754}
table{width:100%;border-collapse:collapse;margin:15px 0}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#f1f1f1}
#statusBanner{display:none;padding:8px;text-align:center;background:#dc3545;color:#fff;font-weight:bold}
canvas{max-width:100%}
</style>
</head>

<body>
<div id="statusBanner">âš ï¸ Offline â€” showing cached data</div>

<h1>ğŸ° Malaysia 4D Results Tracker</h1>

<button onclick="loadResults('magnum')" class="active">Magnum</button>
<button onclick="loadResults('toto')">Toto</button>
<button onclick="loadResults('damacai')">Da Ma Cai</button>

<input id="search" placeholder="Search number" oninput="searchNumber()" />

<h2 id="title"></h2>

<table id="results"></table>

<h2>ğŸ“Š Frequency</h2>
<table id="frequency"></table>

<h2>ğŸ”¥ Hot & â„ï¸ Cold Numbers</h2>
<canvas id="chart" height="200"></canvas>

<h2>ğŸ¯ Suggested Numbers</h2>
<ul id="predictions"></ul>

<h2>ğŸ¤– AI Combined Predictions</h2>
<table id="aiTable"></table>

<h2>ğŸ§  Why These Numbers?</h2>
<div id="aiExplain"></div>
 
<button onclick="exportCSV()">ğŸ“¥ Export CSV</button>
<button id="installBtn" style="display:none">ğŸ“² Install App</button>

<script>
const API='https://opensheet.elk.sh/16NJ3an81qlkX7HWcLOXnxQc-x4GXvpk_KbHXgVEVSn0/1';
let allData=[],current='magnum';

async function fetchData(){
 try{
  const r=await fetch(API); const d=await r.json();
  if(d.length) localStorage.setItem('4d',JSON.stringify(d));
  return d;
 }catch{
  return JSON.parse(localStorage.getItem('4d')||'[]');
 }
}

async function loadResults(type){
 current=type;
 allData=(await fetchData()).filter(r=>r.Company?.toLowerCase()==type);
 document.getElementById('title').innerText=type.toUpperCase()+" RESULTS";
 renderTable(allData); renderFreq(allData);
}

function renderTable(d){
 const t=document.getElementById('results');
 t.innerHTML='<tr><th>Date</th><th>1st</th><th>2nd</th><th>3rd</th></tr>';
 d.forEach(r=>{
  t.innerHTML+=`<tr><td>${r.Date}</td><td>${r.First}</td><td>${r.Second}</td><td>${r.Third}</td></tr>`;
 });
}

function renderFreq(d){
 const f={};
 d.forEach(r=>[r.First,r.Second,r.Third].forEach(n=>f[n]=(f[n]||0)+1));
 const t=document.getElementById('frequency');
 t.innerHTML='<tr><th>Number</th><th>Count</th></tr>';
 Object.entries(f).sort((a,b)=>b[1]-a[1]).slice(0,20)
 .forEach(([n,c])=>t.innerHTML+=`<tr><td>${n}</td><td>${c}</td></tr>`);
 chart(f); predict(f);
}

function chart(freq){
 const c=document.getElementById('chart'),x=c.getContext('2d');
 x.clearRect(0,0,c.width,c.height);
 Object.entries(freq).slice(0,10).forEach(([n,v],i)=>{
  x.fillStyle='#dc3545'; x.fillRect(i*30,200-v*5,20,v*5);
 });
}

function predict(freq){
 const arr=Object.keys(freq);
 document.getElementById('predictions').innerHTML=
 arr.sort(()=>0.5-Math.random()).slice(0,4).map(n=>`<li>${n}</li>`).join('');
}

function searchNumber(){
 const q=search.value;
 renderTable(allData.filter(r=>[r.First,r.Second,r.Third].some(n=>n.includes(q))));
}

function exportCSV(){
 let csv="Date,1st,2nd,3rd\n";
 allData.forEach(r=>csv+=`${r.Date},${r.First},${r.Second},${r.Third}\n`);
 const a=document.createElement('a');
 a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
 a.download='4d.csv'; a.click();
}

// offline banner
const b=document.getElementById('statusBanner');
addEventListener('offline',()=>b.style.display='block');
addEventListener('online',()=>b.style.display='none');

// PWA
if('serviceWorker'in navigator) navigator.serviceWorker.register('service-worker.js');
let p; addEventListener('beforeinstallprompt',e=>{e.preventDefault();p=e;installBtn.style.display='block'});
installBtn.onclick=()=>{p.prompt();installBtn.style.display='none'};

loadResults('magnum');
</script>
</body>
</html>
